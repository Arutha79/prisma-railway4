// interaction_memory.js
const fs = require('fs');
const path = require('path');

// ğŸ“ Chemin vers le fichier JSON
const MEMORY_FILE = path.join(__dirname, 'interaction_history.json');

// ğŸ“¦ Chargement sÃ©curisÃ©
function loadInteractionHistory() {
    try {
        const raw = fs.readFileSync(MEMORY_FILE, 'utf-8');
        const data = JSON.parse(raw);
        if (Array.isArray(data)) {
            return data;
        } else {
            console.warn("âš ï¸ Fichier JSON trouvÃ© mais ce nâ€™est pas un tableau. RÃ©initialisation.");
            return [];
        }
    } catch (err) {
        console.warn("âš ï¸ Fichier manquant ou illisible. CrÃ©ation dâ€™un tableau vide.");
        return [];
    }
}

// ğŸ’¾ Sauvegarde sÃ©curisÃ©e
function saveInteractionHistory(history) {
    try {
        fs.writeFileSync(MEMORY_FILE, JSON.stringify(history, null, 2), 'utf-8');
        console.log("âœ… MÃ©moire enregistrÃ©e avec succÃ¨s.");
    } catch (err) {
        console.error("âŒ Ã‰chec de la sauvegarde :", err.message);
    }
}

// â• Ajouter une interaction
function addInteraction(entry) {
    const history = loadInteractionHistory();
    history.push({
        ...entry,
        date: new Date().toISOString()
    });
    saveInteractionHistory(history);
}

// ğŸ§ª Exemple dâ€™utilisation
if (require.main === module) {
    const newEntry = {
        prompt: "Quel est le sens de la vie ?",
        gpt_3_5: "42",
        gpt_4: "42, mais avec nuance.",
        coherence: "identique"
    };
    addInteraction(newEntry);
}
