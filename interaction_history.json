// interaction_history.js
const fs = require('fs');
const path = require('path');

// üìå Chemin du fichier m√©moire
const MEMORY_FILE = path.join(__dirname, 'interaction_history.json');

// ‚úÖ Fonction : Charger l‚Äôhistorique
function loadHistory() {
    try {
        const data = fs.readFileSync(MEMORY_FILE, 'utf-8');
        const parsed = JSON.parse(data);
        return Array.isArray(parsed) ? parsed : [];
    } catch (err) {
        console.warn("‚ö†Ô∏è Fichier manquant ou corrompu. Historique vide charg√©.");
        return [];
    }
}

// ‚úÖ Fonction : Sauvegarder l‚Äôhistorique
function saveHistory(history) {
    if (!Array.isArray(history)) {
        console.error("‚ùå Donn√©e non sauvegard√©e : ce n‚Äôest pas un tableau.");
        return;
    }
    try {
        fs.writeFileSync(MEMORY_FILE, JSON.stringify(history, null, 2), 'utf-8');
    } catch (err) {
        console.error("‚ùå Erreur de sauvegarde :", err.message);
    }
}

// ‚úÖ Fonction : Ajouter une interaction
function addInteraction(entry) {
    const history = loadHistory();
    history.push({
        ...entry,
        date: new Date().toISOString()
    });
    saveHistory(history);
}

// üì¶ Export des fonctions
module.exports = {
    loadHistory,
    saveHistory,
    addInteraction
};
